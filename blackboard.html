<template name="blackboard">
<div id="bb-body">

<div class="container-fluid bb-content">

<div class="navbar navbar-inverse navbar-fixed-top bb-topbar">
  <div class="navbar-inner">
<!-- login/mute buttons -->
  <div class="bb-buttonbar pull-right">
   <div>
    {{#if sessionNick}}
     <div class="btn-group">
      <a class="btn btn-small btn-inverse dropdown-toggle"
	 data-toggle="dropdown" href="#">
       <i class="icon-user icon-white"></i> {{sessionNick}}
       <span class="caret"></span>
      </a>
      <ul class="dropdown-menu pull-right">
       <li><a class="canEdit-true">
       <label class="radio inline">
	<i class="icon-pencil"></i>
	<input type="radio" name="editable" value="true"/> Allow edits
       </label>
       </a></li>
       <li><a class="canEdit-false">
       <label class="radio">
	<i class="icon-lock"></i>
	<input type="radio" name="editable" value="false"/> Protect page
       </label>
       </a></li>

       <li class="divider"></li>
       <li><a href="#" class="logout"><i class="icon-off"></i> Log out</a></li>
      </ul>
     </div>
    {{else}}
    <button class="btn btn-small btn-inverse">
     <i class="icon-user icon-white"></i>
     Log in to edit
    </button>
    {{/if}}
   </div>
   <div>
    <button class="mute btn btn-small btn-inverse">
     <span class="{{volumeIcon}} icon-white"></span>
    </button>
   </div>
  </div>
<!-- Last update bar -->
  <div class="bb-lastupdate">
    <span class="right pull-right">
    <a href="#" id="bb-more-updates">more...</a>
    </span>
    <span class="left">
    <strong>Last update:</strong>
    </span>
    <span class="center">
    {{#with lastupdates}}
    <span class="timestamp">{{pretty_ts timestamp}}</span>
    {{message}}{{type}}<span class="object-names">{{names}}</span>
    {{#if nick}} (<strong>{{nick}}</strong>){{/if}}
    {{/with}}
    </span>
  </div>
<!-- Last chat bar -->
  <div class="bb-lastchat">
    <span class="right pull-right">
      <a href="/c/general/0" id="bb-more-chats">more...</a>
    </span>
    <span class="left pull-left">
      <strong>Last chats:</strong>
    </span>
    <span class="center">
    {{#each lastchats}}
    <p class="messageRow">
    <span class="timestamp">{{pretty_ts timestamp}}</span>
    <strong>{{nick}}:</strong>
    {{body}}
    </p>
    {{/each}}
    </span>
  </div>

</div></div>

<!-- puzzles w/ index -->
<div class="row-fluid">
  <div id="bb-sidebar" class="span2">
    <ul class="nav nav-list bb-sidenav span2">
      {{#each roundgroups}}
      <li class="nav-header">{{name}}</li>
      {{#each rounds}}
      <li><a title="r{{round_num}}" href="#r{{round._id}}"><i class="icon-chevron-right"></i>
      {{round.name}}</a></li>
      {{/each}}
      {{/each}}
    </ul>
  </div>
  <div id="bb-tables" class="span10">
    <!-- content div -->
    <h1>Codex Puzzle Blackboard</h1>

    {{#each roundgroups}}
    <section id="group{{_id}}">
    <h2>{{name}}</h2>
    {{#each rounds}}
      {{> blackboard_round }}
    {{/each}}
    {{>blackboard_tags}}
    </section>
    {{/each}}
  </div>
</div>
</div>
</div>
</template>

<template name="blackboard_round">
  <section id="r{{round._id}}">
  <h3><a href="/r/{{round._id}}" class="round-link">{{round.name}}</a>
      <small>(r{{round_num}})</small>
  </h3>

  {{#if hasPuzzles}}
  <table class="table table-bordered table-condensed bb-puzzle">
    <tr>
      <th class="puzzle-name">Name</th>
      <th class="puzzle-answer">Solution</th>
      <th class="puzzle-status">Status</th>
      <th class="puzzle-working">Working on this</th>
      <th class="puzzle-update">Last update</th>
    </tr>
    {{#each puzzles}}
      {{> blackboard_puzzle}}
    {{/each}}
  </table>
  {{else}}
  <i>No puzzles in this round yet.</i>
  {{/if}}
  {{#with round}}{{>blackboard_tags}}{{/with}}
  </section>
</template>

<template name="blackboard_puzzle">
  <tr><!-- {{id}} -->
    <td class="puzzle-name">
      <a href="/p/{{puzzle._id}}" title="r{{round_num}}p{{puzzle_num}}" class="puzzle-link">{{puzzle.name}}</a>
      {{#with puzzle}}{{>blackboard_puzzle_tags}}{{/with}}
    </td>
    <td class="puzzle-answer">{{#if puzzle.answer}}<span class="answer">{{puzzle.answer}}</span>{{/if}}</td>
    <td class="puzzle-status">{{status}}</td>
    <td class="puzzle-working">
      {{#each whos_working}}
        <span class="nick {{#unless foreground}}background{{/unless}}">{{nick}}</span>
      {{/each}}
    </td>
    <td class="puzzle-update">
      {{#if puzzle.solved}}solved {{pretty_ts puzzle.solved}}
      {{else}}added {{pretty_ts puzzle.created}}
      {{/if}}
    </td>
  </tr>
</template>

<template name="blackboard_tags">
  <dl class="dl-horizontal">{{#each tags}}
    <dt>{{name}}:</dt><dd>{{value}}</dd>
  {{/each}}</dl>
</template>

<template name="blackboard_puzzle_tags">
  <table class="bb-tag-table"><tbody>{{!
    }}{{#each tags}}{{!
      }}{{#unless equal canon "status"}}
        <tr><td>{{name}}:</td><td>{{value}}</td></tr>
      {{/unless}}{{!
    }}{{/each}}{{!
  }}</tbody></table>
</template>
